[![.NET](https://github.com/JWMB/AzureMonitorCommonAlertSchemaTypes/actions/workflows/dotnet.yml/badge.svg)](https://github.com/JWMB/AzureMonitorCommonAlertSchemaTypes/actions/workflows/dotnet.yml)

# AzureMonitorCommonAlertSchemaTypes
A `.NETStandard 2.1` library with types and serializing utils for [azureMonitorCommonAlertSchema](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-definitions)

*Work in progress*

## Rant
No type information seems to be provided by Microsoft for handling alert payloads - no JSON Schema and no type libraries. This library is built on guesswork based on various example payloads. Lots of properties are of type `string` in this library, but are probably `enum`s in reality. How can we find out?

Also overall design principles seem lacking.
* Sometimes properties are camelCase, sometimes PascalCase.
* Compare ServiceHealthAlertContext with ResourceHealthAlertContext - some properties sound like they should be shared, but the types differ. 
* `GreaterThan` AND `Greater Than` - also `LessThan` AND `Lower Than`..?

## Supported variations
([Auto-generated information](/Tests/GenerateDocumentation.cs))
<!-- BEGIN:Variants -->
* ActivityLogAlertContext - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#monitoringservice--activity-log---administrative)
* LogAlertsV2AlertContext
	* DynamicThresholdCriteria - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#metric-alerts---dynamic-threshold)
	* LogQueryCriteria - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#monitoringservice--log-alerts-v2)
	* SingleResourceMultipleMetricCriteria - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#metric-alerts---static-threshold)
	* WebtestLocationAvailabilityCriteria
* LogAnalyticsAlertContext - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#monitoringservice--log-alerts-v1--metric)
* ResourceHealthAlertContext - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#monitoringservice--resource-health)
* ServiceHealthAlertContext - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#monitoringservice--servicehealth)
* SmartAlertContext - [example](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions#monitoringservice--smart-alert)
<!-- END:Variants -->

See [ActionGroupTests](/Tests/Json/ActionGroupTests) for the payloads generated by [Azure ActionGroup tester](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/action-groups#test-an-action-group-in-the-azure-portal-preview) (also [this](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-common-schema-test-action-definitions))

The respective unit tests can be found in [ActionGroupTests.cs](/Tests/ActionGroupTests.cs)

Example usage in [AzureAlerts2Slack](https://github.com/JWMB/AzureAlerts2Slack/blob/main/AlertInfo.cs)
or
```C#
var alert = Types.AlertJsonSerializerSettings.DeserializeOrThrow(requestBody);
if (ctx is Types.AlertContexts.LogAnalyticsAlertContext ctxLogAnalytics)
{
    Console.Log($"{alert.Data.Essentials.AlertRule} - tables:{string.Join(", ", ctxLogAnalytics.SearchResults.Tables.Select(o => o.Name))}");
}
```

Repo that uses this library in an Azure Function for posting to Slack: [AzureAlerts2Slack](https://github.com/JWMB/AzureAlerts2Slack/blob/main/AlertInfo.cs) 

Related 3rd-party repos
* [Azure-Monitor-Alerts-To-MsTeams](https://github.com/Brink-Software/Azure-Monitor-Alerts-To-MsTeams)
* [Common-Alert-Schema](https://github.com/scautomation/Common-Alert-Schema)

